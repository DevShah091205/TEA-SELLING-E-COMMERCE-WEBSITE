<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heritage and Aroma - Premium Tea Blends</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tea-dark': {
                            light: '#6B8E23', 
                            DEFAULT: '#4A4A3A',
                            dark: '#3A3A2A',
                        },
                        'tea-accent': {
                            light: '#D2B48C',
                            DEFAULT: '#C19A6B',
                            dark: '#AA865B',
                        },
                    },
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; }
        .nav-link { @apply text-white hover:text-tea-accent-light transition-colors duration-200; }
        .btn { @apply px-6 py-2 rounded-lg font-semibold text-white transition-all duration-300; }
        .btn-gold { @apply bg-tea-accent hover:bg-tea-accent-dark shadow-md hover:shadow-lg; }
        .btn-green { @apply bg-tea-dark hover:bg-tea-dark-dark text-white; }
        #app-content { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #message-modal { transition: opacity 0.3s, transform 0.3s; }
    </style>
</head>
<body class="text-gray-900">

    <div id="app" class="min-h-screen flex flex-col">
        <header id="main-header" class="bg-tea-dark text-white shadow-lg sticky top-0 z-50">
            </header>

        <main id="app-content" class="flex-grow">
            </main>

        <footer id="main-footer" class="bg-tea-dark-dark text-white p-10 mt-16">
            <div class="container mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h5 class="text-xl font-bold mb-4 text-tea-accent">Quick Links</h5>
                    <ul class="space-y-2">
                        <li><a href="#" class="nav-link" data-nav="home">Home</a></li>
                        <li><a href="#" class="nav-link" data-nav="shop">Shop Teas</a></li>
                        <li><a href="#" class="nav-link" data-nav="about">Our Heritage</a></li>
                        <li><a href="#" class="nav-link" data-nav="contact">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="text-xl font-bold mb-4 text-tea-accent">About Us</h5>
                    <p class="text-gray-300">Sharing the finest tea blends since 2005. Premium authentic flavour and aroma.</p>
                </div>
                <div>
                    <h5 class="text-xl font-bold mb-4 text-tea-accent">Subscribe</h5>
                    <div class="flex">
                        <input type="email" placeholder="Enter your email" class="flex-grow p-2 rounded-l-lg text-gray-900 focus:outline-none">
                        <button class="btn btn-gold rounded-l-none">Subscribe</button>
                    </div>
                </div>
            </div>
            <div class="text-center text-gray-400 border-t border-tea-dark-light mt-8 pt-6">
                &copy; 2025 Heritage and Aroma. EST 2005. All Rights Reserved.
            </div>
        </footer>
    </div>

    <div id="message-modal" class="fixed top-5 right-5 bg-tea-dark text-white p-4 rounded-lg shadow-xl translate-x-full opacity-0 z-50">
        <span id="message-text"></span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- STATE MANAGEMENT ---
            const state = {
                user: null, // Stores logged in user info
                authMode: 'login', // 'login' or 'register'
                currentPage: 'home',
                cart: [],
                selectedProductId: null,
                filterOpen: false, 
                selectedFilter: 'All',
                selectedCaffeine: 'All',
                selectedPriceRange: 'All',
            };

            // --- MOCK DATA ---
            const PRODUCTS = [
                { id: 1, name: 'Assam Gold Blend', brand: 'Heritage & Aroma', price: 18.00, description: 'A bold, malty Assam blend perfect for a morning cup.', image: 'https://placehold.co/600x600/4A4A3A/C19A6B?text=Assam+Gold', related: [2, 3, 4] },
                { id: 2, name: 'Jasmine Green Harmony', brand: 'Zen Teas', price: 14.50, description: 'Delicate green tea scented with fresh jasmine flowers.', image: 'https://placehold.co/600x600/C19A6B/4A4A3A?text=Jasmine+Green', related: [1, 5, 6] },
                { id: 3, name: 'Earl Grey Reserve', brand: 'Heritage & Aroma', price: 22.00, description: 'Premium black tea infused with high-quality bergamot oil.', image: 'https://placehold.co/600x600/4A4A3A/C19A6B?text=Earl+Grey', related: [4, 7, 8] },
                { id: 4, name: 'Peppermint Revive', brand: 'Herbal Infusions', price: 11.50, description: 'A refreshing, naturally caffeine-free herbal tea.', image: 'https://placehold.co/600x600/C19A6B/4A4A3A?text=Peppermint', related: [1, 2, 5] },
                { id: 5, name: 'Darjeeling First Flush', brand: 'Premium Estates', price: 35.00, description: 'The champagne of teas. Light, bright spring harvest.', image: 'https://placehold.co/600x600/4A4A3A/C19A6B?text=Darjeeling', related: [6, 7, 1] },
                { id: 6, name: 'Spiced Chai', brand: 'Aroma Blends', price: 16.00, description: 'A warming blend of black tea, cinnamon, cardamom.', image: 'https://placehold.co/600x600/C19A6B/4A4A3A?text=Spiced+Chai', related: [8, 3, 2] },
                { id: 7, name: 'Hibiscus Berry', brand: 'Herbal Infusions', price: 13.50, description: 'A vibrant, tart blend rich in antioxidants.', image: 'https://placehold.co/600x600/4A4A3A/C19A6B?text=Hibiscus', related: [1, 4, 8] },
                { id: 8, name: 'Rooibos Vanilla', brand: 'Heritage & Aroma', price: 15.00, description: 'Naturally sweet red tea with a creamy vanilla finish.', image: 'https://placehold.co/600x600/C19A6B/4A4A3A?text=Rooibos', related: [2, 5, 7] },
            ];

            // --- DOM SELECTORS ---
            const app = document.getElementById('app');
            const header = document.getElementById('main-header');
            const content = document.getElementById('app-content');
            const messageModal = document.getElementById('message-modal');
            const messageText = document.getElementById('message-text');

            // --- UTILITY FUNCTIONS ---
            function showMessage(message) {
                messageText.textContent = message;
                messageModal.classList.remove('translate-x-full', 'opacity-0');
                messageModal.classList.add('translate-x-0', 'opacity-100');
                setTimeout(() => {
                    messageModal.classList.add('translate-x-full', 'opacity-0');
                    messageModal.classList.remove('translate-x-0', 'opacity-100');
                }, 3000);
            }

            function getCartItemCount() { return state.cart.reduce((total, item) => total + item.quantity, 0); }
            
            function getCartTotals() {
                const subtotal = state.cart.reduce((total, item) => total + (PRODUCTS.find(p=>p.id===item.id).price * item.quantity), 0);
                const shipping = subtotal > 0 ? 5.00 : 0.00;
                const taxes = subtotal * 0.08;
                return { subtotal: subtotal.toFixed(2), shipping: shipping.toFixed(2), taxes: taxes.toFixed(2), grandTotal: (subtotal + shipping + taxes).toFixed(2) };
            }

            function updateCartQuantity(id, quantity) {
                const idx = state.cart.findIndex(i => i.id === id);
                if (idx > -1) {
                    if (quantity > 0) state.cart[idx].quantity = quantity;
                    else state.cart.splice(idx, 1);
                    renderPage(); renderHeader();
                }
            }

            function addToCart(id, quantity = 1) {
                const existing = state.cart.find(i => i.id === id);
                if (existing) existing.quantity += quantity;
                else state.cart.push({ id, quantity });
                showMessage('Added to cart!');
                renderHeader();
            }

            function removeFromCart(id) {
                state.cart = state.cart.filter(i => i.id !== id);
                renderPage(); renderHeader();
            }

            function getProductFilterTag(p) {
                if (p.name.includes('Chai')) return 'Chai';
                if (p.name.includes('Darjeeling')) return 'Darjeeling';
                if (p.name.includes('Green')) return 'Green Tea';
                if (p.name.includes('Peppermint') || p.name.includes('Hibiscus')) return 'Herbal Infusion';
                if (p.name.includes('Rooibos')) return 'Rooibos';
                return 'Black Tea';
            }

            function getProductCaffeineLevel(p) {
                if (p.name.includes('Peppermint') || p.name.includes('Rooibos') || p.name.includes('Hibiscus')) return 'Caffeine Free';
                if (p.name.includes('Green')) return 'Low';
                return 'High';
            }

            function isProductInPriceRange(p, range) {
                if (range === 'All') return true;
                if (range === 'Under $15') return p.price < 15;
                if (range === '$15 - $25') return p.price >= 15 && p.price <= 25;
                if (range === 'Over $25') return p.price > 25;
                return false;
            }

            // --- AUTHENTICATION & VALIDATION ---
            
            function validateAuth(name, email, phone, password) {
                // 1. All fields required (Name only required for register)
                if (state.authMode === 'register' && !name) return "Name is required.";
                if (!email || !password) return "Email and Password are required.";
                if (state.authMode === 'register' && !phone) return "Phone is required.";

                // 4. Email should end with "@gmail.com"
                if (!email.endsWith('@gmail.com')) {
                    return "Email must be a valid @gmail.com address.";
                }

                // 5. Phone number: only numbers, exactly 10 digits (Register only)
                if (state.authMode === 'register') {
                    const phoneRegex = /^\d{10}$/;
                    if (!phoneRegex.test(phone)) {
                        return "Phone number must be exactly 10 digits (numbers only).";
                    }
                }

                // 2 & 3. Password: length 8-10, complex (Register only)
                if (state.authMode === 'register') {
                    if (password.length < 8 || password.length > 10) {
                        return "Password must be between 8 and 10 characters.";
                    }
                    // Upper, Lower, Number, Special
                    const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,10}$/;
                    if (!passwordRegex.test(password)) {
                        return "Password must contain Uppercase, Lowercase, Number, and a Special Symbol.";
                    }
                }

                return null; // Valid
            }

            // --- RENDERERS ---

            function renderHeader() {
                const cartCount = getCartItemCount();
                const userSection = state.user 
                    ? `<div class="flex items-center space-x-3">
                         <span class="text-sm font-medium text-tea-accent-light">Hi, ${state.user.name}</span>
                         <button class="text-xs bg-red-700 hover:bg-red-600 px-3 py-1 rounded transition" data-action="logout">Logout</button>
                       </div>`
                    : `<button class="text-sm font-bold hover:text-tea-accent-light transition" data-nav="auth">Login / Sign Up</button>`;

                header.innerHTML = `
                    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                        <h1 class="text-3xl font-bold text-tea-accent">
                            <a href="#" data-nav="home" class="hover:text-tea-accent-light">Heritage and Aroma</a>
                        </h1>
                        <nav class="hidden md:block">
                            <ul class="flex space-x-6 items-center">
                                <li><a href="#" class="nav-link ${state.currentPage === 'home' ? 'font-bold underline' : ''}" data-nav="home">Home</a></li>
                                <li><a href="#" class="nav-link ${state.currentPage === 'shop' ? 'font-bold underline' : ''}" data-nav="shop">Shop Teas</a></li>
                                <li><a href="#" class="nav-link ${state.currentPage === 'about' ? 'font-bold underline' : ''}" data-nav="about">About</a></li>
                                <li><a href="#" class="nav-link ${state.currentPage === 'contact' ? 'font-bold underline' : ''}" data-nav="contact">Contact</a></li>
                                <li class="border-l border-gray-600 pl-6">${userSection}</li>
                            </ul>
                        </nav>
                        <div class="flex items-center space-x-4">
                            <button class="relative p-2 text-white hover:text-tea-accent-light" data-nav="cart">
                                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                                <span class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-tea-dark transform translate-x-1/2 -translate-y-1/2 bg-tea-accent rounded-full">${cartCount}</span>
                            </button>
                        </div>
                    </div>
                `;
            }

            function renderAuthPage() {
                const isLogin = state.authMode === 'login';
                return `
                    <section class="container mx-auto px-4 py-16 flex justify-center items-center">
                        <div class="bg-white w-full max-w-md p-8 rounded-xl shadow-2xl border-t-4 border-tea-accent">
                            <div class="flex justify-center mb-8 border-b border-gray-200">
                                <button class="w-1/2 pb-3 font-bold text-lg transition-colors ${isLogin ? 'text-tea-dark border-b-2 border-tea-dark' : 'text-gray-400 hover:text-gray-600'}" data-action="switch-auth-mode" data-mode="login">Login</button>
                                <button class="w-1/2 pb-3 font-bold text-lg transition-colors ${!isLogin ? 'text-tea-dark border-b-2 border-tea-dark' : 'text-gray-400 hover:text-gray-600'}" data-action="switch-auth-mode" data-mode="register">Register</button>
                            </div>

                            <h2 class="text-2xl font-bold text-tea-dark mb-2 text-center">${isLogin ? 'Welcome Back' : 'Create Account'}</h2>
                            <p class="text-center text-gray-500 mb-6 text-sm">${isLogin ? 'Login to access your order history' : 'Join us to track orders and get rewards'}</p>

                            <form id="auth-form" class="space-y-4">
                                ${!isLogin ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Full Name</label>
                                        <input type="text" id="auth-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-tea-accent focus:border-tea-accent transition" placeholder="John Doe">
                                    </div>
                                ` : ''}
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Email Address</label>
                                    <input type="email" id="auth-email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-tea-accent focus:border-tea-accent transition" placeholder="you@gmail.com">
                                </div>

                                ${!isLogin ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Phone Number</label>
                                        <input type="text" id="auth-phone" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-tea-accent focus:border-tea-accent transition" placeholder="9876543210">
                                        <p class="text-xs text-gray-400 mt-1">10 digits only</p>
                                    </div>
                                ` : ''}

                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Password</label>
                                    <input type="password" id="auth-password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-tea-accent focus:border-tea-accent transition" placeholder="********">
                                    ${!isLogin ? '<p class="text-xs text-gray-400 mt-1">8-10 chars, Upper, Lower, Number, Symbol</p>' : ''}
                                </div>

                                <div id="auth-error" class="hidden bg-red-50 text-red-600 text-sm p-3 rounded-lg border border-red-200"></div>

                                <button type="submit" class="btn btn-gold w-full text-lg">
                                    ${isLogin ? 'Login' : 'Register'}
                                </button>
                            </form>
                        </div>
                    </section>
                `;
            }

            // ... [Keep existing renderProductCard, renderHomePage, renderShopPage, renderProductDetailPage, renderCartPage, renderCheckoutPage, renderStaticPage] ...
            
            function renderProductCard(product) {
                return `<div class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden"><a href="#" data-nav="product-detail" data-id="${product.id}"><img src="${product.image}" alt="${product.name}" class="w-full h-64 object-cover"></a><div class="p-5"><h4 class="text-xl font-semibold text-tea-dark mb-1">${product.name}</h4><p class="text-gray-500 mb-3">${product.brand}</p><p class="text-2xl font-bold text-tea-accent mb-4">$${product.price.toFixed(2)}</p><button class="btn btn-green w-full" data-action="add-to-cart" data-id="${product.id}">Add to Cart</button></div></div>`;
            }
            function renderHomePage() {
                return `<section class="bg-tea-dark h-96 md:h-screen flex items-center"><div class="container mx-auto px-4 z-10 text-center text-white"><h2 class="text-5xl md:text-7xl font-extrabold mb-4 text-tea-accent-light">Taste the Heritage. Experience the Aroma.</h2><p class="text-xl md:text-2xl mb-8 font-light">Discover our collection of hand-picked, premium tea blends from the finest estates.</p><a href="#" class="btn btn-gold text-lg" data-nav="shop">Explore Our Teas</a></div></section><section class="container mx-auto px-4 py-16"><h3 class="text-3xl font-bold text-center mb-10 text-tea-dark">Featured Tea Blends</h3><div class="grid grid-cols-1 md:grid-cols-3 gap-8">${PRODUCTS.slice(0, 3).map(p => renderProductCard(p)).join('')}</div></section>`;
            }
            function renderShopPage() {
                const filtered = PRODUCTS.filter(p => {
                    const type = state.selectedFilter === 'All' || getProductFilterTag(p) === state.selectedFilter;
                    const caff = state.selectedCaffeine === 'All' || getProductCaffeineLevel(p) === state.selectedCaffeine;
                    const price = state.selectedPriceRange === 'All' || isProductInPriceRange(p, state.selectedPriceRange);
                    return type && caff && price;
                });
                // (Simplified Shop Filters for brevity, assume same as before)
                return `<section class="container mx-auto px-4 py-12"><h2 class="text-4xl font-bold text-center mb-6 text-tea-dark">Our Full Collection</h2><div class="mb-8 flex justify-center space-x-2"><button class="btn btn-green" data-action="toggle-filter">Filters</button></div>
                <div id="filter-panel" class="${state.filterOpen ? 'block' : 'hidden'} bg-white p-4 mb-6 rounded shadow">
                    <div class="flex flex-wrap gap-2 mb-4"><span class="font-bold">Type:</span> <button class="px-2 bg-gray-200 rounded" data-action="set-type-filter" data-filter-value="All">All</button> <button class="px-2 bg-gray-200 rounded" data-action="set-type-filter" data-filter-value="Black Tea">Black Tea</button> <button class="px-2 bg-gray-200 rounded" data-action="set-type-filter" data-filter-value="Green Tea">Green Tea</button></div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">${filtered.length?filtered.map(renderProductCard).join(''):'<p>No teas found.</p>'}</div></section>`;
            }
            function renderProductDetailPage(id) {
                const p = PRODUCTS.find(x => x.id === id);
                if(!p) return '<div class="p-10 text-center">Not Found</div>';
                return `<section class="container mx-auto px-4 py-12"><div class="grid grid-cols-1 lg:grid-cols-2 gap-12 bg-white p-8 rounded-xl shadow-lg"><div><img src="${p.image}" class="w-full rounded"></div><div><h2 class="text-4xl font-bold mb-4">${p.name}</h2><p class="text-2xl text-tea-accent mb-6">$${p.price.toFixed(2)}</p><p>${p.description}</p><button class="btn btn-gold mt-6" data-action="add-to-cart" data-id="${p.id}">Add to Cart</button></div></div></section>`;
            }
            function renderCartPage() {
                if(state.cart.length===0) return `<section class="container mx-auto px-4 py-24 text-center"><h2 class="text-4xl font-bold">Cart Empty</h2><button class="btn btn-gold mt-4" data-nav="shop">Shop</button></section>`;
                const totals = getCartTotals();
                const items = state.cart.map(c => { const p = PRODUCTS.find(x=>x.id===c.id); return `<div class="flex justify-between border-b py-4"><span>${p.name}</span><div class="flex space-x-4"><input type="number" value="${c.quantity}" class="w-12 border" data-action="update-quantity" data-id="${p.id}"><span>$${(p.price*c.quantity).toFixed(2)}</span><button class="text-red-500" data-action="remove-from-cart" data-id="${p.id}">X</button></div></div>`}).join('');
                return `<section class="container mx-auto px-4 py-12"><h2 class="text-3xl font-bold mb-8">Your Cart</h2><div class="bg-white p-6 rounded shadow">${items}<div class="mt-6 text-right text-xl font-bold">Total: $${totals.grandTotal}</div><button class="btn btn-gold w-full mt-6" data-nav="checkout">Checkout</button></div></section>`;
            }
            function renderCheckoutPage() {
                return `<section class="container mx-auto px-4 py-12"><h2 class="text-3xl font-bold text-center mb-8">Checkout</h2><div class="max-w-lg mx-auto bg-white p-8 rounded shadow"><p>Order Total: $${getCartTotals().grandTotal}</p><button class="btn btn-gold w-full mt-4" data-action="complete-purchase">Pay Now</button></div></section>`;
            }
            function renderStaticPage(t, c) { return `<section class="container mx-auto px-4 py-16 bg-white p-10 rounded shadow"><h2 class="text-4xl font-bold mb-8">${t}</h2>${c}</section>`; }


            function renderPage() {
                content.innerHTML = ''; 
                content.classList.remove('opacity-0', 'translate-y-10');
                void content.offsetWidth; 
                content.classList.add('opacity-100', 'translate-y-0');

                switch (state.currentPage) {
                    case 'home': content.innerHTML = renderHomePage(); break;
                    case 'shop': content.innerHTML = renderShopPage(); break;
                    case 'auth': content.innerHTML = renderAuthPage(); break; // NEW AUTH PAGE
                    case 'product-detail': content.innerHTML = renderProductDetailPage(state.selectedProductId); break;
                    case 'cart': content.innerHTML = renderCartPage(); break;
                    case 'checkout': content.innerHTML = renderCheckoutPage(); break;
                    case 'about': content.innerHTML = renderStaticPage("Our Heritage", "<p>Since 2005...</p>"); break;
                    case 'contact': content.innerHTML = renderStaticPage("Contact Us", "<p>Email: info@tea.com</p>"); break;
                    default: content.innerHTML = renderHomePage();
                }

                // Attach Auth Listener if on auth page
                if (state.currentPage === 'auth') {
                    const form = document.getElementById('auth-form');
                    if (form) {
                        form.addEventListener('submit', (e) => {
                            e.preventDefault();
                            const name = document.getElementById('auth-name')?.value;
                            const email = document.getElementById('auth-email').value;
                            const phone = document.getElementById('auth-phone')?.value;
                            const password = document.getElementById('auth-password').value;
                            const errorDiv = document.getElementById('auth-error');

                            const error = validateAuth(name, email, phone, password);

                            if (error) {
                                errorDiv.textContent = error;
                                errorDiv.classList.remove('hidden');
                            } else {
                                // SUCCESS
                                state.user = { name: name || 'User', email };
                                showMessage(state.authMode === 'login' ? 'Login Successful!' : 'Account Created!');
                                navigateTo('home');
                            }
                        });
                    }
                }
            }

            function navigateTo(page, id = null) {
                state.currentPage = page;
                state.selectedProductId = id;
                renderPage();
                renderHeader();
                window.scrollTo(0, 0);
            }

            // --- EVENT DELEGATION ---
            app.addEventListener('click', (e) => {
                const nav = e.target.closest('[data-nav]');
                const act = e.target.closest('[data-action]');
                
                if (nav) {
                    e.preventDefault();
                    navigateTo(nav.dataset.nav, parseInt(nav.dataset.id));
                } else if (act) {
                    const action = act.dataset.action;
                    const id = parseInt(act.dataset.id);

                    if (action === 'add-to-cart') addToCart(id);
                    else if (action === 'remove-from-cart') removeFromCart(id);
                    else if (action === 'update-quantity') {/* handled by change event */}
                    else if (action === 'toggle-filter') { state.filterOpen = !state.filterOpen; renderPage(); }
                    else if (action === 'set-type-filter') { state.selectedFilter = act.dataset.filterValue; renderPage(); }
                    else if (action === 'complete-purchase') { 
                        if(!state.user) { showMessage('Please Login to checkout'); navigateTo('auth'); }
                        else { showMessage('Order Placed!'); state.cart=[]; renderHeader(); navigateTo('home'); }
                    }
                    
                    // AUTH ACTIONS
                    else if (action === 'logout') {
                        state.user = null;
                        showMessage('Logged out successfully.');
                        renderHeader();
                        if(state.currentPage === 'cart' || state.currentPage === 'checkout') navigateTo('home');
                    }
                    else if (action === 'switch-auth-mode') {
                        state.authMode = act.dataset.mode;
                        renderPage(); // Re-render auth page with new mode
                    }
                }
            });

            app.addEventListener('change', (e) => {
                if (e.target.closest('[data-action="update-quantity"]')) {
                    updateCartQuantity(parseInt(e.target.dataset.id), parseInt(e.target.value));
                }
            });

            // INIT
            renderHeader();
            renderPage();
        });
    </script>
</body>
</html>