<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heritage and Aroma - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tea-dark': {
                            // Deep Olive / Tea Leaf (Primary)
                            light: '#6B8E23', 
                            DEFAULT: '#4A4A3A',
                            dark: '#3A3A2A',
                        },
                        'tea-accent': {
                            // Faded Gold / Tan (Accent)
                            light: '#D2B48C',
                            DEFAULT: '#C19A6B',
                            dark: '#AA865B',
                        },
                        'admin-blue': '#2563EB', // Admin highlight color
                    },
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f5f7;
        }
        .sidebar-link {
            @apply flex items-center p-3 text-sm font-medium rounded-lg text-gray-200 hover:bg-tea-dark-light hover:text-white transition-colors duration-200;
        }
        .sidebar-link.active {
            @apply bg-tea-accent text-tea-dark-dark font-bold hover:bg-tea-accent-dark;
        }
        .card {
            @apply bg-white p-6 rounded-xl shadow-lg border-t-4 border-tea-accent;
        }
        .action-btn {
            @apply px-3 py-1 text-xs rounded transition-colors duration-200;
        }
        /* Page transition styles (simple fade) */
        #admin-content {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        /* Modal Backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="text-gray-900">

    <div id="app" class="flex min-h-screen">
        
        <aside id="sidebar" class="w-64 bg-tea-dark p-4 shadow-2xl sticky top-0 h-screen hidden md:block">
            <h1 class="text-2xl font-bold text-tea-accent mb-8 border-b border-tea-dark-light pb-3">
                <span class="text-white">H&A</span> Admin
            </h1>

            <nav class="space-y-2">
                <a href="#" class="sidebar-link" data-nav="dashboard">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0h6m-6 0h-2M9 12h6"></path></svg>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="sidebar-link" data-nav="products">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2h2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v2M7 7h10"></path></svg>
                    <span>Product Management</span>
                </a>
                <a href="#" class="sidebar-link" data-nav="orders">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
                    <span>Order Management</span>
                </a>
                <a href="#" class="sidebar-link" data-nav="customers">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    <span>Customer Management</span>
                </a>
                <a href="#" class="sidebar-link" data-nav="categories">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>
                    <span>Category Management</span>
                </a>
                <a href="#" class="sidebar-link" data-nav="settings">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.298.608 3.3 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    <span>Settings</span>
                </a>
            </nav>
            
            <div class="absolute bottom-4 text-xs text-gray-400">
                <p>&copy; 2025 H&A Admin</p>
            </div>
        </aside>

        <main id="admin-content" class="flex-grow p-4 md:p-8">
            </main>
    </div>

    <div id="edit-modal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop hidden">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg mx-4 transform transition-all duration-300 scale-95 opacity-0">
            <h3 id="modal-title" class="text-2xl font-bold mb-4 text-tea-dark border-b pb-2">Edit Item</h3>
            <div id="modal-body" class="space-y-4">
                </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button class="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300" data-action="close-modal">Cancel</button>
                <button id="modal-save-btn" class="px-4 py-2 text-white bg-admin-blue rounded-lg hover:bg-admin-blue/90" data-action="save-modal">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="message-modal" class="fixed top-5 right-5 bg-admin-blue text-white p-4 rounded-lg shadow-xl translate-x-full opacity-0 z-50">
        <span id="message-text"></span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- STATE MANAGEMENT ---
            const state = {
                currentPage: 'dashboard',
                editingItem: null, // Stores { type: 'product', id: 1 } for modal context
                
                // MOCK DATA (Now fully reactive)
                PRODUCTS: [
                    { id: 1, name: 'Assam Gold Blend', brand: 'Heritage & Aroma', price: 18.00, description: 'A bold, malty Assam blend...', stock: 150, type: 'Black Tea', caffeine: 'High' },
                    { id: 2, name: 'Jasmine Green Harmony', brand: 'Zen Teas', price: 14.50, description: 'Delicate green tea...', stock: 80, type: 'Green Tea', caffeine: 'Low' },
                    { id: 3, name: 'Earl Grey Reserve', brand: 'Heritage & Aroma', price: 22.00, description: 'Premium black tea infused with high-quality bergamot oil...', stock: 210, type: 'Black Tea', caffeine: 'High' },
                    { id: 4, name: 'Peppermint Revive', brand: 'Herbal Infusions', price: 11.50, description: 'A refreshing, naturally caffeine-free herbal tea...', stock: 95, type: 'Herbal Infusion', caffeine: 'Caffeine Free' },
                    { id: 5, name: 'Darjeeling First Flush', brand: 'Premium Estates', price: 35.00, description: 'The champagne of teas...', stock: 40, type: 'Darjeeling', caffeine: 'High' },
                    { id: 6, name: 'Spiced Chai', brand: 'Aroma Blends', price: 16.00, description: 'A warming blend of black tea, cinnamon, cardamom, and cloves...', stock: 120, type: 'Chai', caffeine: 'High' },
                    { id: 7, name: 'Hibiscus Berry', brand: 'Herbal Infusions', price: 13.50, description: 'A vibrant, tart blend that brews a beautiful crimson color...', stock: 180, type: 'Herbal Infusion', caffeine: 'Caffeine Free' },
                    { id: 8, name: 'Rooibos Vanilla', brand: 'Heritage & Aroma', price: 15.00, description: 'Naturally sweet and woody South African red tea...', stock: 75, type: 'Rooibos', caffeine: 'Caffeine Free' },
                ], 

                ORDERS: [
                    { id: 1001, customer: 'Alice Johnson', date: '2025-10-25', total: 45.50, status: 'Shipped', items: 3, details: ['Assam Gold (2)', 'Peppermint Revive (1)'], shipping: '123 Tea Rd' },
                    { id: 1002, customer: 'Bob Smith', date: '2025-10-26', total: 110.25, status: 'Processing', items: 5, details: ['Darjeeling First (5)'], shipping: '456 Brew St' },
                    { id: 1003, customer: 'Charlie Brown', date: '2025-10-26', total: 22.00, status: 'Delivered', items: 1, details: ['Earl Grey Reserve (1)'], shipping: '789 Cup Ave' },
                    { id: 1004, customer: 'Diana Prince', date: '2025-10-27', total: 18.00, status: 'Cancelled', items: 1, details: ['Assam Gold (1)'], shipping: '101 Wonder Ln' },
                    { id: 1005, customer: 'Eve Adams', date: '2025-10-27', total: 55.00, status: 'Shipped', items: 4, details: ['Spiced Chai (4)'], shipping: '202 Aroma Way' },
                ],

                CUSTOMERS: [
                    { id: 201, name: 'Alice Johnson', email: 'alice@example.com', orders: 5, totalSpent: 350.00, lastOrder: '2025-10-25' },
                    { id: 202, name: 'Bob Smith', email: 'bob@example.com', orders: 1, totalSpent: 110.25, lastOrder: '2025-10-26' },
                    { id: 203, name: 'Charlie Brown', email: 'charlie@example.com', orders: 12, totalSpent: 620.50, lastOrder: '2025-10-26' },
                    { id: 204, name: 'Diana Prince', email: 'diana@example.com', orders: 2, totalSpent: 65.00, lastOrder: '2025-10-27' },
                ],

                CATEGORIES: [
                    { id: 1, name: 'Black Tea', count: 3, description: 'Bold and rich flavour profiles.' },
                    { id: 2, name: 'Green Tea', count: 1, description: 'Light, fresh, and often floral.' },
                    { id: 3, name: 'Herbal Infusion', count: 2, description: 'Naturally caffeine-free and soothing.' },
                ],
                
                SETTINGS: {
                    shippingRate: 5.00,
                    taxRate: 8.00,
                    storeName: 'Heritage and Aroma',
                }
            };


            // --- DOM SELECTORS ---
            const content = document.getElementById('admin-content');
            const messageModal = document.getElementById('message-modal');
            const messageText = document.getElementById('message-text');
            const editModal = document.getElementById('edit-modal');
            const modalBody = document.getElementById('modal-body');
            const modalTitle = document.getElementById('modal-title');
            const modalSaveBtn = document.getElementById('modal-save-btn');

            // --- UTILITY FUNCTIONS ---
            function showMessage(message) {
                messageText.textContent = message;
                messageModal.classList.remove('translate-x-full', 'opacity-0');
                messageModal.classList.add('translate-x-0', 'opacity-100');
                setTimeout(() => {
                    messageModal.classList.add('translate-x-full', 'opacity-0');
                    messageModal.classList.remove('translate-x-0', 'opacity-100');
                }, 3000);
            }

            function formatCurrency(amount) {
                return `$${parseFloat(amount).toFixed(2)}`;
            }

            function getStatusClass(status) {
                if (status === 'Delivered') return 'bg-green-100 text-green-800';
                if (status === 'Shipped') return 'bg-admin-blue text-white';
                if (status === 'Processing') return 'bg-yellow-100 text-yellow-800';
                if (status === 'Cancelled') return 'bg-red-100 text-red-800';
                return 'bg-gray-100 text-gray-800';
            }

            function openModal(type, id) {
                let item;
                state.editingItem = { type, id: parseInt(id) };

                if (type === 'product') {
                    item = state.PRODUCTS.find(p => p.id === state.editingItem.id);
                    modalTitle.textContent = `Edit Product: ${item.name}`;
                    modalBody.innerHTML = renderProductEditForm(item);
                } else if (type === 'order') {
                    item = state.ORDERS.find(o => o.id === state.editingItem.id);
                    modalTitle.textContent = `Edit Order: #${item.id}`;
                    modalBody.innerHTML = renderOrderEditForm(item);
                } else if (type === 'customer') {
                    item = state.CUSTOMERS.find(c => c.id === state.editingItem.id);
                    modalTitle.textContent = `Edit Customer: ${item.name}`;
                    modalBody.innerHTML = renderCustomerEditForm(item);
                } else if (type === 'category') {
                    item = state.CATEGORIES.find(c => c.id === state.editingItem.id);
                    modalTitle.textContent = `Edit Category: ${item.name}`;
                    modalBody.innerHTML = renderCategoryEditForm(item);
                }
                
                editModal.classList.remove('hidden');
                setTimeout(() => {
                    editModal.querySelector('div').classList.remove('scale-95', 'opacity-0');
                    editModal.querySelector('div').classList.add('scale-100', 'opacity-100');
                }, 10);
            }

            function closeModal() {
                editModal.querySelector('div').classList.add('scale-95', 'opacity-0');
                editModal.querySelector('div').classList.remove('scale-100', 'opacity-100');
                setTimeout(() => {
                    editModal.classList.add('hidden');
                    state.editingItem = null;
                }, 300);
            }

            /**
             * Helper for rendering a standard input field in the modal.
             * @param {string} label - The label text.
             * @param {string} id - The input ID.
             * @param {string} value - The current value.
             * @param {string} type - The input type.
             */
            function renderInputField(label, id, value, type = 'text') {
                return `
                    <div>
                        <label for="${id}" class="block text-sm font-medium text-gray-700">${label}</label>
                        <input type="${type}" id="${id}" value="${value}" class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-admin-blue focus:border-admin-blue">
                    </div>
                `;
            }

            // --- CRUD FUNCTIONS (Data Manipulation) ---

            function updateProduct(id, formData) {
                const index = state.PRODUCTS.findIndex(p => p.id === id);
                if (index > -1) {
                    state.PRODUCTS[index] = {
                        ...state.PRODUCTS[index],
                        name: formData.name,
                        price: parseFloat(formData.price),
                        stock: parseInt(formData.stock),
                        brand: formData.brand,
                    };
                    showMessage('Product updated successfully!');
                    closeModal();
                    renderPage(); // Re-render everything to update Dashboard/Table
                }
            }

            function deleteItem(type, id) {
                const idInt = parseInt(id);
                if (confirm(`Are you sure you want to delete this ${type} with ID ${id}?`)) {
                    if (type === 'product') state.PRODUCTS = state.PRODUCTS.filter(p => p.id !== idInt);
                    else if (type === 'order') state.ORDERS = state.ORDERS.filter(o => o.id !== idInt);
                    else if (type === 'customer') state.CUSTOMERS = state.CUSTOMERS.filter(c => c.id !== idInt);
                    else if (type === 'category') state.CATEGORIES = state.CATEGORIES.filter(c => c.id !== idInt);

                    showMessage(`${type} ID ${id} deleted successfully!`);
                    renderPage();
                }
            }
            
            // --- MODAL FORM RENDERERS ---

            function renderProductEditForm(product) {
                return `
                    <form id="edit-product-form">
                        ${renderInputField('Product Name', 'edit-name', product.name)}
                        ${renderInputField('Brand', 'edit-brand', product.brand)}
                        <div class="grid grid-cols-2 gap-4">
                            ${renderInputField('Price ($)', 'edit-price', product.price.toFixed(2), 'number')}
                            ${renderInputField('Stock Quantity', 'edit-stock', product.stock, 'number')}
                        </div>
                        <p class="text-xs text-gray-500 mt-2">Note: Description, Type, and Caffeine fields are not editable in this simple form.</p>
                    </form>
                `;
            }

            function renderOrderEditForm(order) {
                const statusOptions = ['Processing', 'Shipped', 'Delivered', 'Cancelled'];
                const statusSelect = statusOptions.map(s => `<option value="${s}" ${order.status === s ? 'selected' : ''}>${s}</option>`).join('');

                return `
                    <form id="edit-order-form">
                        ${renderInputField('Customer', 'edit-customer', order.customer)}
                        <div class="grid grid-cols-2 gap-4">
                            ${renderInputField('Total ($)', 'edit-total', order.total.toFixed(2), 'number')}
                            ${renderInputField('Date', 'edit-date', order.date, 'date')}
                        </div>
                        <div>
                            <label for="edit-status" class="block text-sm font-medium text-gray-700">Status</label>
                            <select id="edit-status" class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-admin-blue focus:border-admin-blue">
                                ${statusSelect}
                            </select>
                        </div>
                        ${renderInputField('Shipping Address', 'edit-shipping', order.shipping)}
                    </form>
                `;
            }
            
            function renderCustomerEditForm(customer) {
                return `
                    <form id="edit-customer-form">
                        ${renderInputField('Customer Name', 'edit-name', customer.name)}
                        ${renderInputField('Email', 'edit-email', customer.email, 'email')}
                        <div class="grid grid-cols-2 gap-4">
                            ${renderInputField('Total Orders', 'edit-orders', customer.orders, 'number')}
                            ${renderInputField('Total Spent ($)', 'edit-spent', customer.totalSpent.toFixed(2), 'number')}
                        </div>
                    </form>
                `;
            }

            function renderCategoryEditForm(category) {
                return `
                    <form id="edit-category-form">
                        ${renderInputField('Category Name', 'edit-name', category.name)}
                        <div>
                            <label for="edit-description" class="block text-sm font-medium text-gray-700">Description</label>
                            <textarea id="edit-description" class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-admin-blue focus:border-admin-blue">${category.description}</textarea>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">Note: Product Count is automatically calculated and not directly editable.</p>
                    </form>
                `;
            }

            // --- PAGE RENDERING FUNCTIONS (UNCHANGED) ---

            function renderDashboardPage() {
                // --- REAL-TIME DATA CALCULATION ---
                const totalRevenue = state.ORDERS.filter(o => o.status !== 'Cancelled').reduce((sum, order) => sum + order.total, 0);
                const totalOrders = state.ORDERS.length;
                const totalProducts = state.PRODUCTS.length;
                const lowStockCount = state.PRODUCTS.filter(p => p.stock < 50).length;

                const metricCards = [
                    { title: 'Total Revenue', value: formatCurrency(totalRevenue), icon: '<svg class="w-6 h-6 text-tea-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8V9m0 3v2m0 3.5a1.5 1.5 0 010-3m0 3v-2m0 0h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' },
                    { title: 'Total Orders', value: totalOrders, icon: '<svg class="w-6 h-6 text-tea-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>' },
                    { title: 'Active Products', value: totalProducts, icon: '<svg class="w-6 h-6 text-tea-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2h2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v2M7 7h10"></path></svg>' },
                    { title: 'Low Stock Items', value: lowStockCount, icon: `<svg class="w-6 h-6 ${lowStockCount > 0 ? 'text-red-500' : 'text-green-500'}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>` },
                ];

                return `
                    <h2 class="text-3xl font-bold mb-8 text-tea-dark">Dashboard</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                        ${metricCards.map(card => `
                            <div class="card flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-500">${card.title}</p>
                                    <p class="text-3xl font-bold text-tea-dark">${card.value}</p>
                                </div>
                                ${card.icon}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-2xl font-bold mb-4 text-tea-dark border-b pb-2">Recent Orders</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    ${state.ORDERS.slice(0, 5).map(order => `
                                        <tr>
                                            <td class="px-4 py-3 text-sm font-medium text-admin-blue cursor-pointer">${order.id}</td>
                                            <td class="px-4 py-3 text-sm">${order.customer}</td>
                                            <td class="px-4 py-3 text-sm font-medium">${formatCurrency(order.total)}</td>
                                            <td class="px-4 py-3">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusClass(order.status)}">
                                                    ${order.status}
                                                </span>
                                            </td>
                                            <td class="px-4 py-3 text-sm text-gray-500">${order.date}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <a href="#" data-nav="orders" class="mt-4 inline-block text-admin-blue hover:text-tea-dark text-sm font-semibold">View All Orders &rarr;</a>
                    </div>
                `;
            }

            function renderProductManagementPage() {
                return `
                    <h2 class="text-3xl font-bold mb-6 text-tea-dark">Product Management</h2>
                    <div class="flex justify-between items-center mb-6">
                        <p class="text-gray-600">${state.PRODUCTS.length} Total Products</p>
                        <button class="btn bg-admin-blue hover:bg-admin-blue/90 text-white" data-action="add-new" data-type="product">
                            + Add New Product
                        </button>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead>
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Price</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Stock</th>
                                    <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${state.PRODUCTS.map(product => `
                                    <tr>
                                        <td class="px-4 py-3 text-sm font-medium text-admin-blue">${product.id}</td>
                                        <td class="px-4 py-3 text-sm">${product.name}</td>
                                        <td class="px-4 py-3 text-sm">${product.type}</td>
                                        <td class="px-4 py-3 text-sm">${formatCurrency(product.price)}</td>
                                        <td class="px-4 py-3 text-sm ${product.stock < 50 ? 'text-red-500 font-semibold' : 'text-green-600'}">${product.stock}</td>
                                        <td class="px-4 py-3 text-center space-x-2">
                                            <button class="action-btn bg-yellow-100 text-yellow-800 hover:bg-yellow-200" data-action="open-edit" data-type="product" data-id="${product.id}">Edit</button>
                                            <button class="action-btn bg-red-100 text-red-800 hover:bg-red-200" data-action="delete-item" data-type="product" data-id="${product.id}">Delete</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            function renderOrderManagementPage() {
                return `
                    <h2 class="text-3xl font-bold mb-6 text-tea-dark">Order Management</h2>
                    <div class="flex justify-between items-center mb-6">
                        <p class="text-gray-600">${state.ORDERS.length} Total Orders</p>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead>
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${state.ORDERS.map(order => `
                                    <tr>
                                        <td class="px-4 py-3 text-sm font-medium text-admin-blue">${order.id}</td>
                                        <td class="px-4 py-3 text-sm">${order.customer}</td>
                                        <td class="px-4 py-3 text-sm">${order.date}</td>
                                        <td class="px-4 py-3 text-sm font-semibold">${formatCurrency(order.total)}</td>
                                        <td class="px-4 py-3">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusClass(order.status)}">
                                                ${order.status}
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-center space-x-2">
                                            <button class="action-btn bg-admin-blue/10 text-admin-blue hover:bg-admin-blue/20" data-action="open-edit" data-type="order" data-id="${order.id}">Edit</button>
                                            <button class="action-btn bg-red-100 text-red-800 hover:bg-red-200" data-action="delete-item" data-type="order" data-id="${order.id}">Delete</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            function renderCustomerManagementPage() {
                return `
                    <h2 class="text-3xl font-bold mb-6 text-tea-dark">Customer Management</h2>
                    <div class="flex justify-between items-center mb-6">
                        <p class="text-gray-600">${state.CUSTOMERS.length} Total Customers</p>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead>
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Orders</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Total Spent</th>
                                    <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${state.CUSTOMERS.map(customer => `
                                    <tr>
                                        <td class="px-4 py-3 text-sm font-medium">${customer.id}</td>
                                        <td class="px-4 py-3 text-sm font-medium text-admin-blue">${customer.name}</td>
                                        <td class="px-4 py-3 text-sm">${customer.email}</td>
                                        <td class="px-4 py-3 text-sm">${customer.orders}</td>
                                        <td class="px-4 py-3 text-sm font-semibold">${formatCurrency(customer.totalSpent)}</td>
                                        <td class="px-4 py-3 text-center space-x-2">
                                            <button class="action-btn bg-admin-blue/10 text-admin-blue hover:bg-admin-blue/20" data-action="open-edit" data-type="customer" data-id="${customer.id}">Edit</button>
                                            <button class="action-btn bg-red-100 text-red-800 hover:bg-red-200" data-action="delete-item" data-type="customer" data-id="${customer.id}">Delete</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            function renderCategoryManagementPage() {
                return `
                    <h2 class="text-3xl font-bold mb-6 text-tea-dark">Category Management</h2>
                    <div class="flex justify-between items-center mb-6">
                        <p class="text-gray-600">${state.CATEGORIES.length} Total Categories</p>
                        <button class="btn bg-admin-blue hover:bg-admin-blue/90 text-white" data-action="add-new" data-type="category">
                            + Add New Category
                        </button>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead>
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Product Count</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                    <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${state.CATEGORIES.map(category => `
                                    <tr>
                                        <td class="px-4 py-3 text-sm font-medium">${category.id}</td>
                                        <td class="px-4 py-3 text-sm font-medium text-admin-blue">${category.name}</td>
                                        <td class="px-4 py-3 text-sm">${category.count}</td>
                                        <td class="px-4 py-3 text-sm text-gray-600">${category.description}</td>
                                        <td class="px-4 py-3 text-center space-x-2">
                                            <button class="action-btn bg-yellow-100 text-yellow-800 hover:bg-yellow-200" data-action="open-edit" data-type="category" data-id="${category.id}">Edit</button>
                                            <button class="action-btn bg-red-100 text-red-800 hover:bg-red-200" data-action="delete-item" data-type="category" data-id="${category.id}">Delete</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            function renderSettingsPage() {
                return `
                    <h2 class="text-3xl font-bold mb-6 text-tea-dark">Settings</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        
                        <div class="bg-white p-6 rounded-xl shadow-lg lg:col-span-2">
                            <h3 class="text-2xl font-bold mb-4 text-tea-dark border-b pb-2">General Site Configuration</h3>
                            <form id="settings-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Store Name</label>
                                    <input type="text" id="setting-storeName" value="${state.SETTINGS.storeName}" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Default Shipping Rate ($)</label>
                                    <input type="number" id="setting-shippingRate" value="${state.SETTINGS.shippingRate.toFixed(2)}" class="mt-1 block w-1/3 p-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Tax Rate (%)</label>
                                    <input type="number" id="setting-taxRate" value="${state.SETTINGS.taxRate.toFixed(2)}" class="mt-1 block w-1/3 p-2 border border-gray-300 rounded-md">
                                </div>
                                <button type="submit" class="btn bg-admin-blue hover:bg-admin-blue/90 text-white" data-action="save-settings">Save General Settings</button>
                            </form>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-2xl font-bold mb-4 text-tea-dark border-b pb-2">Security & Users</h3>
                            <p class="text-gray-600 mb-4">Manage admin accounts and password policies.</p>
                            <button class="btn bg-tea-dark hover:bg-tea-dark-light w-full mb-3 text-white" data-action="manage-users">Manage Users</button>
                            <button class="btn bg-red-600 hover:bg-red-700 w-full text-white" data-action="change-password">Change Password</button>
                        </div>
                    </div>
                `;
            }

            // --- NAVIGATION AND RENDER MANAGEMENT (UNCHANGED) ---

            function renderPage() {
                closeModal();

                content.innerHTML = ''; 
                document.querySelectorAll('.sidebar-link').forEach(link => link.classList.remove('active'));
                
                const activeLink = document.querySelector(`[data-nav="${state.currentPage}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }

                switch (state.currentPage) {
                    case 'dashboard':
                        content.innerHTML = renderDashboardPage();
                        break;
                    case 'products':
                        content.innerHTML = renderProductManagementPage();
                        break;
                    case 'orders':
                        content.innerHTML = renderOrderManagementPage();
                        break;
                    case 'customers':
                        content.innerHTML = renderCustomerManagementPage();
                        break;
                    case 'categories':
                        content.innerHTML = renderCategoryManagementPage();
                        break;
                    case 'settings':
                        content.innerHTML = renderSettingsPage();
                        break;
                    default:
                        content.innerHTML = renderDashboardPage();
                }
            }

            function navigateTo(page) {
                if (state.currentPage !== page) {
                    state.currentPage = page;
                    renderPage();
                    window.scrollTo(0, 0); 
                }
            }

            // --- EVENT LISTENERS (FIX APPLIED HERE) ---

            /**
             * Global event listener for navigation and simulated actions
             * FIX: Changed listener from document.getElementById('app') to document
             */
            document.addEventListener('click', (e) => {
                const navTarget = e.target.closest('[data-nav]');
                const actionTarget = e.target.closest('[data-action]');
                
                if (navTarget) {
                    e.preventDefault();
                    navigateTo(navTarget.dataset.nav);

                } else if (actionTarget) {
                    e.preventDefault();
                    const action = actionTarget.dataset.action;
                    const id = actionTarget.dataset.id;
                    const type = actionTarget.dataset.type;

                    if (action === 'open-edit') {
                        openModal(type, id);

                    } else if (action === 'close-modal') {
                        closeModal();

                    } else if (action === 'save-modal') {
                        // Check if a valid item type is being edited
                        if (!state.editingItem || !state.editingItem.type) {
                            showMessage('Error: No item selected for editing.');
                            closeModal();
                            return;
                        }

                        const form = document.getElementById(`edit-${state.editingItem.type}-form`);
                        const itemId = state.editingItem.id;

                        const formData = {};
                        form.querySelectorAll('input, select, textarea').forEach(input => {
                            formData[input.id.replace('edit-', '')] = input.value;
                        });
                        
                        // Dispatch to specific update logic
                        if (state.editingItem.type === 'product') {
                            updateProduct(itemId, formData);

                        } else if (state.editingItem.type === 'order') {
                            const index = state.ORDERS.findIndex(o => o.id === itemId);
                            state.ORDERS[index].customer = formData.customer;
                            state.ORDERS[index].total = parseFloat(formData.total);
                            state.ORDERS[index].status = formData.status;
                            showMessage('Order updated successfully!');
                            closeModal();
                            renderPage();

                        } else if (state.editingItem.type === 'customer') {
                            const index = state.CUSTOMERS.findIndex(c => c.id === itemId);
                            state.CUSTOMERS[index].name = formData.name;
                            state.CUSTOMERS[index].email = formData.email;
                            state.CUSTOMERS[index].totalSpent = parseFloat(formData.spent);
                            showMessage('Customer updated successfully!');
                            closeModal();
                            renderPage();
                            
                        } else if (state.editingItem.type === 'category') {
                            const index = state.CATEGORIES.findIndex(c => c.id === itemId);
                            state.CATEGORIES[index].name = formData.name;
                            state.CATEGORIES[index].description = formData.description;
                            showMessage('Category updated successfully!');
                            closeModal();
                            renderPage();
                        }


                    } else if (action === 'delete-item') {
                        deleteItem(type, id);

                    } else if (action === 'save-settings') {
                        const shippingRate = parseFloat(document.getElementById('setting-shippingRate').value);
                        const taxRate = parseFloat(document.getElementById('setting-taxRate').value);
                        const storeName = document.getElementById('setting-storeName').value;

                        state.SETTINGS.shippingRate = shippingRate;
                        state.SETTINGS.taxRate = taxRate;
                        state.SETTINGS.storeName = storeName;

                        showMessage('Settings saved and applied!');
                        renderPage(); 

                    } else if (action.startsWith('add-new') || action.startsWith('manage-users') || action.startsWith('change-password')) {
                        showMessage(`Simulating: Action "${action}" executed. This is where a real application would navigate or open a complex form.`);
                    }
                }
            });

            // --- INITIALIZATION ---
            renderPage(); // Render the initial dashboard page
        });
    </script>
</body>
</html>